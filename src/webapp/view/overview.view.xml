<mvc:View
	controllerName="com.budgetBook.controller.overview"
	xmlns="sap.m"
	xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:u="sap.ui.unified"
    xmlns:kM="kellojo.m"
    height="100%"
    width="100%"
    id="idAppView">

    <kM:Page class="budgetBookPage" title="{i18n>overviewPageTitle}" 
    subTitle="{
        parts: ['Database>/transactions', '/currentTab'],
        formatter: '.formatPageSubtitle'
    }">

        <kM:actions>
            <OverflowToolbar width="100%">
                <ToolbarSpacer />
                <SegmentedButton selectedKey="{/currentChartType}">
					<items>
						<SegmentedButtonItem icon="sap-icon://donut-chart" tooltip="{i18n>chartTypeByCategory}" key="byCategory" />
						<SegmentedButtonItem icon="sap-icon://line-chart-time-axis" tooltip="{i18n>chartTypeOverTime}" key="overTime"/>
					</items>
				</SegmentedButton>
                <Button press="onAddButtonPress" text="{i18n>addTransaction}"/>
            </OverflowToolbar>
        </kM:actions>

        <kM:mainAction>
            <SearchField width="250px" liveChange="onSearch"/>
        </kM:mainAction>
            
        <kM:content>

            <kM:LineChart dataPoints="{ parts: ['Database>/transactions', '/currentTab'], formatter: '.formatMonthChartData'}" visible="{= ${/currentChartType} === 'overTime'}"/>
            <kM:LineChart dataPoints="{ parts: ['Database>/transactions', '/currentTab'], formatter: '.formatMonthChartData'}" visible="{= ${/currentChartType} === 'byCategory'}"/>

            <kM:TableActions>
                <MenuButton id="idMonthTabButton" type="Transparent" text="{ path: '/currentTab', formatter: '.formatCurrentTab'}">
                    <Menu items="{/months}" itemSelected="onTabChanged">
                        <MenuItem text="{text}" startsSection="{isYear}">
                            <customData>
                                <core:CustomData key="time" value="{key}"></core:CustomData>
                                <core:CustomData key="isCurrentMonth" value="{isCurrentString}" writeToDom="true"></core:CustomData>
                                <core:CustomData key="isYear" value="{isYearString}" writeToDom="true"></core:CustomData>
                            </customData>
                        </MenuItem>
                    </Menu>
                </MenuButton>
            </kM:TableActions>

            <Table id="idTable" items="{ 
                path: 'Database>/transactions',
                sorter : {
                    path : 'occurredOn',
                    comparator: '.sortByDate'
                }
            }" 
            mode="MultiSelect"
            itemPress="onTransactionPress">
                <columns>
                    <Column>
                        <Label text="Transaction" />
                    </Column>
                    <Column hAlign="End">
                        <Label text="Amount" />
                    </Column>
                    <Column>
                        <Label text="Category" />
                    </Column>
                    <Column width="48px" />
                </columns>

                <ColumnListItem type="Active" class="budgetBookOverview-transactionItem">
                    <VBox>
                        <Text text="{Database>title}" class="kellojoM-lineSpacing"/>
                        <Label text="{ path: 'Database>occurredOn', formatter: '.formatter.fromNow'}" class="budgetBookTable-lightLabel"/>
                    </VBox>
                    
                    <u:Currency value="{Database>amount}" currency="EUR" maxPrecision="2" useSymbol="true" class="budgetBookOverview-currency"/>
                    <Label text="{Database>category}"/>
                    
                    <Button icon="sap-icon://delete" press="onDeleteTransactionPress" type="Unstyled" class="budgetBookOverview-deleteIcon"/>
                </ColumnListItem>
            </Table>
        </kM:content>

    </kM:Page>

</mvc:View>